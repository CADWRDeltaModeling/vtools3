
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>matplotlib.font_manager &#8212; vtools 3.6.6+1.g092ced5.dirty documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../index.html"><img src="../../_static/logo.png" border="0" alt="py4sci"/></a>
</div>



      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/dwrsmall.jpg" alt="Logo"/>
            </a></p>
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/dwrsmall.jpg" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts.html">Introduction and concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interpolation.html">Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/filters.html">Averging, Filtering and Low Passing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/filters.html#Filters">Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../history.html">History</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for matplotlib.font_manager</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A module for finding, managing, and using fonts across platforms.</span>

<span class="sd">This module provides a single `FontManager` instance that can</span>
<span class="sd">be shared across backends and platforms.  The `findfont`</span>
<span class="sd">function returns the best TrueType (TTF) font file in the local or</span>
<span class="sd">system font path that matches the specified `FontProperties`</span>
<span class="sd">instance.  The `FontManager` also handles Adobe Font Metrics</span>
<span class="sd">(AFM) font files for use by the PostScript backend.</span>

<span class="sd">The design is based on the `W3C Cascading Style Sheet, Level 1 (CSS1)</span>
<span class="sd">font specification &lt;http://www.w3.org/TR/1998/REC-CSS2-19980512/&gt;`_.</span>
<span class="sd">Future versions may implement the Level 2 or 2.1 specifications.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># KNOWN ISSUES</span>
<span class="c1">#</span>
<span class="c1">#   - documentation</span>
<span class="c1">#   - font variant is untested</span>
<span class="c1">#   - font stretch is incomplete</span>
<span class="c1">#   - font size is incomplete</span>
<span class="c1">#   - default font algorithm needs improvement and testing</span>
<span class="c1">#   - setWeights function needs improvement</span>
<span class="c1">#   - &#39;light&#39; is an invalid weight value, remove it.</span>

<span class="kn">import</span> <span class="nn">dataclasses</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Number</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">threading</span>
    <span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">dummy_threading</span> <span class="k">as</span> <span class="nn">threading</span>
    <span class="kn">from</span> <span class="nn">dummy_threading</span> <span class="kn">import</span> <span class="n">Timer</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">_api</span><span class="p">,</span> <span class="n">afm</span><span class="p">,</span> <span class="n">cbook</span><span class="p">,</span> <span class="n">ft2font</span><span class="p">,</span> <span class="n">rcParams</span>
<span class="kn">from</span> <span class="nn">matplotlib.fontconfig_pattern</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">parse_fontconfig_pattern</span><span class="p">,</span> <span class="n">generate_fontconfig_pattern</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">matplotlib.rcsetup</span> <span class="kn">import</span> <span class="n">_validators</span>

<span class="n">_log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">font_scalings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;xx-small&#39;</span><span class="p">:</span> <span class="mf">0.579</span><span class="p">,</span>
    <span class="s1">&#39;x-small&#39;</span><span class="p">:</span>  <span class="mf">0.694</span><span class="p">,</span>
    <span class="s1">&#39;small&#39;</span><span class="p">:</span>    <span class="mf">0.833</span><span class="p">,</span>
    <span class="s1">&#39;medium&#39;</span><span class="p">:</span>   <span class="mf">1.0</span><span class="p">,</span>
    <span class="s1">&#39;large&#39;</span><span class="p">:</span>    <span class="mf">1.200</span><span class="p">,</span>
    <span class="s1">&#39;x-large&#39;</span><span class="p">:</span>  <span class="mf">1.440</span><span class="p">,</span>
    <span class="s1">&#39;xx-large&#39;</span><span class="p">:</span> <span class="mf">1.728</span><span class="p">,</span>
    <span class="s1">&#39;larger&#39;</span><span class="p">:</span>   <span class="mf">1.2</span><span class="p">,</span>
    <span class="s1">&#39;smaller&#39;</span><span class="p">:</span>  <span class="mf">0.833</span><span class="p">,</span>
    <span class="kc">None</span><span class="p">:</span>       <span class="mf">1.0</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">stretch_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ultra-condensed&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s1">&#39;extra-condensed&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
    <span class="s1">&#39;condensed&#39;</span><span class="p">:</span>       <span class="mi">300</span><span class="p">,</span>
    <span class="s1">&#39;semi-condensed&#39;</span><span class="p">:</span>  <span class="mi">400</span><span class="p">,</span>
    <span class="s1">&#39;normal&#39;</span><span class="p">:</span>          <span class="mi">500</span><span class="p">,</span>
    <span class="s1">&#39;semi-expanded&#39;</span><span class="p">:</span>   <span class="mi">600</span><span class="p">,</span>
    <span class="s1">&#39;semi-extended&#39;</span><span class="p">:</span>   <span class="mi">600</span><span class="p">,</span>
    <span class="s1">&#39;expanded&#39;</span><span class="p">:</span>        <span class="mi">700</span><span class="p">,</span>
    <span class="s1">&#39;extended&#39;</span><span class="p">:</span>        <span class="mi">700</span><span class="p">,</span>
    <span class="s1">&#39;extra-expanded&#39;</span><span class="p">:</span>  <span class="mi">800</span><span class="p">,</span>
    <span class="s1">&#39;extra-extended&#39;</span><span class="p">:</span>  <span class="mi">800</span><span class="p">,</span>
    <span class="s1">&#39;ultra-expanded&#39;</span><span class="p">:</span>  <span class="mi">900</span><span class="p">,</span>
    <span class="s1">&#39;ultra-extended&#39;</span><span class="p">:</span>  <span class="mi">900</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">weight_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ultralight&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s1">&#39;light&#39;</span><span class="p">:</span>      <span class="mi">200</span><span class="p">,</span>
    <span class="s1">&#39;normal&#39;</span><span class="p">:</span>     <span class="mi">400</span><span class="p">,</span>
    <span class="s1">&#39;regular&#39;</span><span class="p">:</span>    <span class="mi">400</span><span class="p">,</span>
    <span class="s1">&#39;book&#39;</span><span class="p">:</span>       <span class="mi">400</span><span class="p">,</span>
    <span class="s1">&#39;medium&#39;</span><span class="p">:</span>     <span class="mi">500</span><span class="p">,</span>
    <span class="s1">&#39;roman&#39;</span><span class="p">:</span>      <span class="mi">500</span><span class="p">,</span>
    <span class="s1">&#39;semibold&#39;</span><span class="p">:</span>   <span class="mi">600</span><span class="p">,</span>
    <span class="s1">&#39;demibold&#39;</span><span class="p">:</span>   <span class="mi">600</span><span class="p">,</span>
    <span class="s1">&#39;demi&#39;</span><span class="p">:</span>       <span class="mi">600</span><span class="p">,</span>
    <span class="s1">&#39;bold&#39;</span><span class="p">:</span>       <span class="mi">700</span><span class="p">,</span>
    <span class="s1">&#39;heavy&#39;</span><span class="p">:</span>      <span class="mi">800</span><span class="p">,</span>
    <span class="s1">&#39;extra bold&#39;</span><span class="p">:</span> <span class="mi">800</span><span class="p">,</span>
    <span class="s1">&#39;black&#39;</span><span class="p">:</span>      <span class="mi">900</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">_weight_regexes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># From fontconfig&#39;s FcFreeTypeQueryFaceInternal; not the same as</span>
    <span class="c1"># weight_dict!</span>
    <span class="p">(</span><span class="s2">&quot;thin&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;extralight&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;ultralight&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;demilight&quot;</span><span class="p">,</span> <span class="mi">350</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;semilight&quot;</span><span class="p">,</span> <span class="mi">350</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;light&quot;</span><span class="p">,</span> <span class="mi">300</span><span class="p">),</span>  <span class="c1"># Needs to come *after* demi/semilight!</span>
    <span class="p">(</span><span class="s2">&quot;book&quot;</span><span class="p">,</span> <span class="mi">380</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;regular&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="mi">500</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;demibold&quot;</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;demi&quot;</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;semibold&quot;</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;extrabold&quot;</span><span class="p">,</span> <span class="mi">800</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;superbold&quot;</span><span class="p">,</span> <span class="mi">800</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;ultrabold&quot;</span><span class="p">,</span> <span class="mi">800</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="mi">700</span><span class="p">),</span>  <span class="c1"># Needs to come *after* extra/super/ultrabold!</span>
    <span class="p">(</span><span class="s2">&quot;ultrablack&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;superblack&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;extrablack&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
    <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\bultra&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="mi">900</span><span class="p">),</span>  <span class="c1"># Needs to come *after* ultra/super/extrablack!</span>
    <span class="p">(</span><span class="s2">&quot;heavy&quot;</span><span class="p">,</span> <span class="mi">900</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">font_family_aliases</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;serif&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sans serif&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cursive&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fantasy&#39;</span><span class="p">,</span>
    <span class="s1">&#39;monospace&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sans&#39;</span><span class="p">,</span>
<span class="p">}</span>


<span class="c1"># OS Font paths</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">_HOME</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># Exceptions thrown by home() are not specified...</span>
    <span class="n">_HOME</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">)</span>  <span class="c1"># Just an arbitrary path with no children.</span>
<span class="n">MSFolders</span> <span class="o">=</span> \
    <span class="sa">r</span><span class="s1">&#39;Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders&#39;</span>
<span class="n">MSFontDirectories</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sa">r</span><span class="s1">&#39;SOFTWARE\Microsoft\Windows NT\CurrentVersion\Fonts&#39;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s1">&#39;SOFTWARE\Microsoft\Windows\CurrentVersion\Fonts&#39;</span><span class="p">]</span>
<span class="n">MSUserFontDirectories</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">_HOME</span> <span class="o">/</span> <span class="s1">&#39;AppData/Local/Microsoft/Windows/Fonts&#39;</span><span class="p">),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">_HOME</span> <span class="o">/</span> <span class="s1">&#39;AppData/Roaming/Microsoft/Windows/Fonts&#39;</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">X11FontDirectories</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># an old standard installation point</span>
    <span class="s2">&quot;/usr/X11R6/lib/X11/fonts/TTF/&quot;</span><span class="p">,</span>
    <span class="s2">&quot;/usr/X11/lib/X11/fonts&quot;</span><span class="p">,</span>
    <span class="c1"># here is the new standard location for fonts</span>
    <span class="s2">&quot;/usr/share/fonts/&quot;</span><span class="p">,</span>
    <span class="c1"># documented as a good place to install new fonts</span>
    <span class="s2">&quot;/usr/local/share/fonts/&quot;</span><span class="p">,</span>
    <span class="c1"># common application, not really useful</span>
    <span class="s2">&quot;/usr/lib/openoffice/share/fonts/truetype/&quot;</span><span class="p">,</span>
    <span class="c1"># user fonts</span>
    <span class="nb">str</span><span class="p">((</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;XDG_DATA_HOME&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_HOME</span> <span class="o">/</span> <span class="s2">&quot;.local/share&quot;</span><span class="p">))</span>
        <span class="o">/</span> <span class="s2">&quot;fonts&quot;</span><span class="p">),</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">_HOME</span> <span class="o">/</span> <span class="s2">&quot;.fonts&quot;</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">OSXFontDirectories</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;/Library/Fonts/&quot;</span><span class="p">,</span>
    <span class="s2">&quot;/Network/Library/Fonts/&quot;</span><span class="p">,</span>
    <span class="s2">&quot;/System/Library/Fonts/&quot;</span><span class="p">,</span>
    <span class="c1"># fonts installed via MacPorts</span>
    <span class="s2">&quot;/opt/local/share/fonts&quot;</span><span class="p">,</span>
    <span class="c1"># user fonts</span>
    <span class="nb">str</span><span class="p">(</span><span class="n">_HOME</span> <span class="o">/</span> <span class="s2">&quot;Library/Fonts&quot;</span><span class="p">),</span>
<span class="p">]</span>


<span class="nd">@lru_cache</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_cached_realpath</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_fontext_synonyms</span><span class="p">(</span><span class="n">fontext</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of file extensions extensions that are synonyms for</span>
<span class="sd">    the given file extension *fileext*.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;afm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;afm&#39;</span><span class="p">],</span>
        <span class="s1">&#39;otf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;otf&#39;</span><span class="p">,</span> <span class="s1">&#39;ttc&#39;</span><span class="p">,</span> <span class="s1">&#39;ttf&#39;</span><span class="p">],</span>
        <span class="s1">&#39;ttc&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;otf&#39;</span><span class="p">,</span> <span class="s1">&#39;ttc&#39;</span><span class="p">,</span> <span class="s1">&#39;ttf&#39;</span><span class="p">],</span>
        <span class="s1">&#39;ttf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;otf&#39;</span><span class="p">,</span> <span class="s1">&#39;ttc&#39;</span><span class="p">,</span> <span class="s1">&#39;ttf&#39;</span><span class="p">],</span>
    <span class="p">}[</span><span class="n">fontext</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">list_fonts</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">extensions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of all fonts matching any of the extensions, found</span>
<span class="sd">    recursively under the directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">ext</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="c1"># os.walk ignores access errors, unlike Path.glob.</span>
            <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span>
            <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">win32FontDirectory</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the user-specified font directory for Win32.  This is</span>
<span class="sd">    looked up from the registry key ::</span>

<span class="sd">      \\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders\Fonts</span>

<span class="sd">    If the key is not found, ``%WINDIR%\Fonts`` will be returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">winreg</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">winreg</span><span class="o">.</span><span class="n">HKEY_CURRENT_USER</span><span class="p">,</span> <span class="n">MSFolders</span><span class="p">)</span> <span class="k">as</span> <span class="n">user</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">winreg</span><span class="o">.</span><span class="n">QueryValueEx</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="s1">&#39;Fonts&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;WINDIR&#39;</span><span class="p">],</span> <span class="s1">&#39;Fonts&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_win32RegistryFonts</span><span class="p">(</span><span class="n">reg_domain</span><span class="p">,</span> <span class="n">base_dir</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search for fonts in the Windows registry.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    reg_domain : int</span>
<span class="sd">        The top level registry domain (e.g. HKEY_LOCAL_MACHINE).</span>

<span class="sd">    base_dir : str</span>
<span class="sd">        The path to the folder where the font files are usually located (e.g.</span>
<span class="sd">        C:\Windows\Fonts). If only the filename of the font is stored in the</span>
<span class="sd">        registry, the absolute path is built relative to this base directory.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    `set`</span>
<span class="sd">        `pathlib.Path` objects with the absolute path to the font files found.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">winreg</span>
    <span class="n">items</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">reg_path</span> <span class="ow">in</span> <span class="n">MSFontDirectories</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">reg_domain</span><span class="p">,</span> <span class="n">reg_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">local</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">winreg</span><span class="o">.</span><span class="n">QueryInfoKey</span><span class="p">(</span><span class="n">local</span><span class="p">)[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="c1"># value may contain the filename of the font or its</span>
                    <span class="c1"># absolute path.</span>
                    <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">winreg</span><span class="o">.</span><span class="n">EnumValue</span><span class="p">(</span><span class="n">local</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># If value contains already an absolute path, then it</span>
                        <span class="c1"># is not changed further.</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                        <span class="c1"># Don&#39;t fail with invalid entries.</span>
                        <span class="k">continue</span>

                    <span class="n">items</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">MemoryError</span><span class="p">):</span>
            <span class="k">continue</span>

    <span class="k">return</span> <span class="n">items</span>


<span class="c1"># Also remove _win32RegistryFonts when this is removed.</span>
<span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">win32InstalledFonts</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fontext</span><span class="o">=</span><span class="s1">&#39;ttf&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search for fonts in the specified font directory, or use the</span>
<span class="sd">    system directories if none given. Additionally, it is searched for user</span>
<span class="sd">    fonts installed. A list of TrueType font filenames are returned by default,</span>
<span class="sd">    or AFM fonts if *fontext* == &#39;afm&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">winreg</span>

    <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">win32FontDirectory</span><span class="p">()</span>

    <span class="n">fontext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">ext</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">get_fontext_synonyms</span><span class="p">(</span><span class="n">fontext</span><span class="p">)]</span>

    <span class="n">items</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1"># System fonts</span>
    <span class="n">items</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_win32RegistryFonts</span><span class="p">(</span><span class="n">winreg</span><span class="o">.</span><span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="n">directory</span><span class="p">))</span>

    <span class="c1"># User fonts</span>
    <span class="k">for</span> <span class="n">userdir</span> <span class="ow">in</span> <span class="n">MSUserFontDirectories</span><span class="p">:</span>
        <span class="n">items</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_win32RegistryFonts</span><span class="p">(</span><span class="n">winreg</span><span class="o">.</span><span class="n">HKEY_CURRENT_USER</span><span class="p">,</span> <span class="n">userdir</span><span class="p">))</span>

    <span class="c1"># Keep only paths with matching file extension.</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">fontext</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_get_win32_installed_fonts</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;List the font paths known to the Windows registry.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">winreg</span>
    <span class="n">items</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="c1"># Search and resolve fonts listed in the registry.</span>
    <span class="k">for</span> <span class="n">domain</span><span class="p">,</span> <span class="n">base_dirs</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">winreg</span><span class="o">.</span><span class="n">HKEY_LOCAL_MACHINE</span><span class="p">,</span> <span class="p">[</span><span class="n">win32FontDirectory</span><span class="p">()]),</span>  <span class="c1"># System.</span>
            <span class="p">(</span><span class="n">winreg</span><span class="o">.</span><span class="n">HKEY_CURRENT_USER</span><span class="p">,</span> <span class="n">MSUserFontDirectories</span><span class="p">),</span>  <span class="c1"># User.</span>
    <span class="p">]:</span>
        <span class="k">for</span> <span class="n">base_dir</span> <span class="ow">in</span> <span class="n">base_dirs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">reg_path</span> <span class="ow">in</span> <span class="n">MSFontDirectories</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">winreg</span><span class="o">.</span><span class="n">OpenKey</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">reg_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">local</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">winreg</span><span class="o">.</span><span class="n">QueryInfoKey</span><span class="p">(</span><span class="n">local</span><span class="p">)[</span><span class="mi">1</span><span class="p">]):</span>
                            <span class="c1"># value may contain the filename of the font or its</span>
                            <span class="c1"># absolute path.</span>
                            <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">winreg</span><span class="o">.</span><span class="n">EnumValue</span><span class="p">(</span><span class="n">local</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                                <span class="k">continue</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="c1"># If value contains already an absolute path,</span>
                                <span class="c1"># then it is not changed further.</span>
                                <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
                            <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                                <span class="c1"># Don&#39;t fail with invalid entries.</span>
                                <span class="k">continue</span>
                            <span class="n">items</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">MemoryError</span><span class="p">):</span>
                    <span class="k">continue</span>
    <span class="k">return</span> <span class="n">items</span>


<span class="nd">@lru_cache</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">_get_fontconfig_fonts</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Cache and list the font paths known to `fc-list`.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="sa">b</span><span class="s1">&#39;--format&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;fc-list&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">]):</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>  <span class="c1"># fontconfig 2.7 implemented --format.</span>
                <span class="s1">&#39;Matplotlib needs fontconfig&gt;=2.7 to query system fonts.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s1">&#39;fc-list&#39;</span><span class="p">,</span> <span class="s1">&#39;--format=%</span><span class="si">{file}</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">fsdecode</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)]</span>


<span class="nd">@_api</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.5&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_fontconfig_fonts</span><span class="p">(</span><span class="n">fontext</span><span class="o">=</span><span class="s1">&#39;ttf&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;List font filenames known to `fc-list` having the given extension.&quot;&quot;&quot;</span>
    <span class="n">fontext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">ext</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">get_fontext_synonyms</span><span class="p">(</span><span class="n">fontext</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">_get_fontconfig_fonts</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">fontext</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">findSystemFonts</span><span class="p">(</span><span class="n">fontpaths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fontext</span><span class="o">=</span><span class="s1">&#39;ttf&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search for fonts in the specified font paths.  If no paths are</span>
<span class="sd">    given, will use a standard set of system paths, as well as the</span>
<span class="sd">    list of fonts tracked by fontconfig if fontconfig is installed and</span>
<span class="sd">    available.  A list of TrueType fonts are returned by default with</span>
<span class="sd">    AFM fonts as an option.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fontfiles</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">fontexts</span> <span class="o">=</span> <span class="n">get_fontext_synonyms</span><span class="p">(</span><span class="n">fontext</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fontpaths</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span><span class="p">:</span>
            <span class="n">installed_fonts</span> <span class="o">=</span> <span class="n">_get_win32_installed_fonts</span><span class="p">()</span>
            <span class="n">fontpaths</span> <span class="o">=</span> <span class="n">MSUserFontDirectories</span> <span class="o">+</span> <span class="p">[</span><span class="n">win32FontDirectory</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">installed_fonts</span> <span class="o">=</span> <span class="n">_get_fontconfig_fonts</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;darwin&#39;</span><span class="p">:</span>
                <span class="n">fontpaths</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">X11FontDirectories</span><span class="p">,</span> <span class="o">*</span><span class="n">OSXFontDirectories</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fontpaths</span> <span class="o">=</span> <span class="n">X11FontDirectories</span>
        <span class="n">fontfiles</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">installed_fonts</span>
                         <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">in</span> <span class="n">fontexts</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fontpaths</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">fontpaths</span> <span class="o">=</span> <span class="p">[</span><span class="n">fontpaths</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">fontpaths</span><span class="p">:</span>
        <span class="n">fontfiles</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">,</span> <span class="n">list_fonts</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fontexts</span><span class="p">)))</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">fname</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fontfiles</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">)]</span>


<span class="n">FontEntry</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">make_dataclass</span><span class="p">(</span>
    <span class="s1">&#39;FontEntry&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;fname&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;variant&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;stretch&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">)),</span>
    <span class="p">],</span>
    <span class="n">namespace</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;__doc__&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    A class for storing Font properties.</span>

<span class="s2">    It is used when populating the font lookup dictionary.</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">})</span>


<span class="k">def</span> <span class="nf">ttfFontProperty</span><span class="p">(</span><span class="n">font</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract information from a TrueType font file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    font : `.FT2Font`</span>
<span class="sd">        The TrueType font file from which information will be extracted.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    `FontEntry`</span>
<span class="sd">        The extracted font properties.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">family_name</span>

    <span class="c1">#  Styles are: italic, oblique, and normal (default)</span>

    <span class="n">sfnt</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_sfnt</span><span class="p">()</span>
    <span class="n">mac_key</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># platform: macintosh</span>
               <span class="mi">0</span><span class="p">,</span>  <span class="c1"># id: roman</span>
               <span class="mi">0</span><span class="p">)</span>  <span class="c1"># langid: english</span>
    <span class="n">ms_key</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span>  <span class="c1"># platform: microsoft</span>
              <span class="mi">1</span><span class="p">,</span>  <span class="c1"># id: unicode_cs</span>
              <span class="mh">0x0409</span><span class="p">)</span>  <span class="c1"># langid: english_united_states</span>

    <span class="c1"># These tables are actually mac_roman-encoded, but mac_roman support may be</span>
    <span class="c1"># missing in some alternative Python implementations and we are only going</span>
    <span class="c1"># to look for ASCII substrings, where any ASCII-compatible encoding works</span>
    <span class="c1"># - or big-endian UTF-16, since important Microsoft fonts use that.</span>
    <span class="n">sfnt2</span> <span class="o">=</span> <span class="p">(</span><span class="n">sfnt</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="o">*</span><span class="n">mac_key</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span>
             <span class="n">sfnt</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="o">*</span><span class="n">ms_key</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf_16_be&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="n">sfnt4</span> <span class="o">=</span> <span class="p">(</span><span class="n">sfnt</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="o">*</span><span class="n">mac_key</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span>
             <span class="n">sfnt</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="o">*</span><span class="n">ms_key</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf_16_be&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">sfnt4</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;oblique&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;oblique&#39;</span>
    <span class="k">elif</span> <span class="n">sfnt4</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;italic&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;italic&#39;</span>
    <span class="k">elif</span> <span class="n">sfnt2</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;regular&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>
    <span class="k">elif</span> <span class="n">font</span><span class="o">.</span><span class="n">style_flags</span> <span class="o">&amp;</span> <span class="n">ft2font</span><span class="o">.</span><span class="n">ITALIC</span><span class="p">:</span>
        <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;italic&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>

    <span class="c1">#  Variants are: small-caps and normal (default)</span>

    <span class="c1">#  !!!!  Untested</span>
    <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;capitals&#39;</span><span class="p">,</span> <span class="s1">&#39;small-caps&#39;</span><span class="p">]:</span>
        <span class="n">variant</span> <span class="o">=</span> <span class="s1">&#39;small-caps&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">variant</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>

    <span class="c1"># The weight-guessing algorithm is directly translated from fontconfig</span>
    <span class="c1"># 2.13.1&#39;s FcFreeTypeQueryFaceInternal (fcfreetype.c).</span>
    <span class="n">wws_subfamily</span> <span class="o">=</span> <span class="mi">22</span>
    <span class="n">typographic_subfamily</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">font_subfamily</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">styles</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">sfnt</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="o">*</span><span class="n">mac_key</span><span class="p">,</span> <span class="n">wws_subfamily</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span>
        <span class="n">sfnt</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="o">*</span><span class="n">mac_key</span><span class="p">,</span> <span class="n">typographic_subfamily</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span>
        <span class="n">sfnt</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="o">*</span><span class="n">mac_key</span><span class="p">,</span> <span class="n">font_subfamily</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin-1&#39;</span><span class="p">),</span>
        <span class="n">sfnt</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="o">*</span><span class="n">ms_key</span><span class="p">,</span> <span class="n">wws_subfamily</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-16-be&#39;</span><span class="p">),</span>
        <span class="n">sfnt</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="o">*</span><span class="n">ms_key</span><span class="p">,</span> <span class="n">typographic_subfamily</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-16-be&#39;</span><span class="p">),</span>
        <span class="n">sfnt</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="o">*</span><span class="n">ms_key</span><span class="p">,</span> <span class="n">font_subfamily</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-16-be&#39;</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">styles</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">styles</span><span class="p">)]</span> <span class="ow">or</span> <span class="p">[</span><span class="n">font</span><span class="o">.</span><span class="n">style_name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_weight</span><span class="p">():</span>  <span class="c1"># From fontconfig&#39;s FcFreeTypeQueryFaceInternal.</span>
        <span class="c1"># OS/2 table weight.</span>
        <span class="n">os2</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_sfnt_table</span><span class="p">(</span><span class="s2">&quot;OS/2&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os2</span> <span class="ow">and</span> <span class="n">os2</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0xffff</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os2</span><span class="p">[</span><span class="s2">&quot;usWeightClass&quot;</span><span class="p">]</span>
        <span class="c1"># PostScript font info weight.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ps_font_info_weight</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">font</span><span class="o">.</span><span class="n">get_ps_font_info</span><span class="p">()[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">regex</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">_weight_regexes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">ps_font_info_weight</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">weight</span>
        <span class="c1"># Style name weight.</span>
        <span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">styles</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">regex</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">_weight_regexes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">weight</span>
        <span class="k">if</span> <span class="n">font</span><span class="o">.</span><span class="n">style_flags</span> <span class="o">&amp;</span> <span class="n">ft2font</span><span class="o">.</span><span class="n">BOLD</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">700</span>  <span class="c1"># &quot;bold&quot;</span>
        <span class="k">return</span> <span class="mi">500</span>  <span class="c1"># &quot;medium&quot;, not &quot;regular&quot;!</span>

    <span class="n">weight</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">get_weight</span><span class="p">())</span>

    <span class="c1">#  Stretch can be absolute and relative</span>
    <span class="c1">#  Absolute stretches are: ultra-condensed, extra-condensed, condensed,</span>
    <span class="c1">#    semi-condensed, normal, semi-expanded, expanded, extra-expanded,</span>
    <span class="c1">#    and ultra-expanded.</span>
    <span class="c1">#  Relative stretches are: wider, narrower</span>
    <span class="c1">#  Child value is: inherit</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">sfnt4</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;narrow&#39;</span><span class="p">,</span> <span class="s1">&#39;condensed&#39;</span><span class="p">,</span> <span class="s1">&#39;cond&#39;</span><span class="p">]):</span>
        <span class="n">stretch</span> <span class="o">=</span> <span class="s1">&#39;condensed&#39;</span>
    <span class="k">elif</span> <span class="s1">&#39;demi cond&#39;</span> <span class="ow">in</span> <span class="n">sfnt4</span><span class="p">:</span>
        <span class="n">stretch</span> <span class="o">=</span> <span class="s1">&#39;semi-condensed&#39;</span>
    <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">sfnt4</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;wide&#39;</span><span class="p">,</span> <span class="s1">&#39;expanded&#39;</span><span class="p">,</span> <span class="s1">&#39;extended&#39;</span><span class="p">]):</span>
        <span class="n">stretch</span> <span class="o">=</span> <span class="s1">&#39;expanded&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stretch</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>

    <span class="c1">#  Sizes can be absolute and relative.</span>
    <span class="c1">#  Absolute sizes are: xx-small, x-small, small, medium, large, x-large,</span>
    <span class="c1">#    and xx-large.</span>
    <span class="c1">#  Relative sizes are: larger, smaller</span>
    <span class="c1">#  Length value is an absolute font size, e.g., 12pt</span>
    <span class="c1">#  Percentage values are in &#39;em&#39;s.  Most robust specification.</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">font</span><span class="o">.</span><span class="n">scalable</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Non-scalable fonts are not supported&quot;</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="s1">&#39;scalable&#39;</span>

    <span class="k">return</span> <span class="n">FontEntry</span><span class="p">(</span><span class="n">font</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">variant</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">stretch</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">afmFontProperty</span><span class="p">(</span><span class="n">fontpath</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract information from an AFM font file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    font : `.AFM`</span>
<span class="sd">        The AFM font file from which information will be extracted.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    `FontEntry`</span>
<span class="sd">        The extracted font properties.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_familyname</span><span class="p">()</span>
    <span class="n">fontname</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_fontname</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1">#  Styles are: italic, oblique, and normal (default)</span>

    <span class="k">if</span> <span class="n">font</span><span class="o">.</span><span class="n">get_angle</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="s1">&#39;italic&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;italic&#39;</span>
    <span class="k">elif</span> <span class="s1">&#39;oblique&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
        <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;oblique&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>

    <span class="c1">#  Variants are: small-caps and normal (default)</span>

    <span class="c1"># !!!!  Untested</span>
    <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;capitals&#39;</span><span class="p">,</span> <span class="s1">&#39;small-caps&#39;</span><span class="p">]:</span>
        <span class="n">variant</span> <span class="o">=</span> <span class="s1">&#39;small-caps&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">variant</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>

    <span class="n">weight</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_weight</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">weight</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">weight_dict</span><span class="p">:</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>

    <span class="c1">#  Stretch can be absolute and relative</span>
    <span class="c1">#  Absolute stretches are: ultra-condensed, extra-condensed, condensed,</span>
    <span class="c1">#    semi-condensed, normal, semi-expanded, expanded, extra-expanded,</span>
    <span class="c1">#    and ultra-expanded.</span>
    <span class="c1">#  Relative stretches are: wider, narrower</span>
    <span class="c1">#  Child value is: inherit</span>
    <span class="k">if</span> <span class="s1">&#39;demi cond&#39;</span> <span class="ow">in</span> <span class="n">fontname</span><span class="p">:</span>
        <span class="n">stretch</span> <span class="o">=</span> <span class="s1">&#39;semi-condensed&#39;</span>
    <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">fontname</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;narrow&#39;</span><span class="p">,</span> <span class="s1">&#39;cond&#39;</span><span class="p">]):</span>
        <span class="n">stretch</span> <span class="o">=</span> <span class="s1">&#39;condensed&#39;</span>
    <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">fontname</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;wide&#39;</span><span class="p">,</span> <span class="s1">&#39;expanded&#39;</span><span class="p">,</span> <span class="s1">&#39;extended&#39;</span><span class="p">]):</span>
        <span class="n">stretch</span> <span class="o">=</span> <span class="s1">&#39;expanded&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stretch</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>

    <span class="c1">#  Sizes can be absolute and relative.</span>
    <span class="c1">#  Absolute sizes are: xx-small, x-small, small, medium, large, x-large,</span>
    <span class="c1">#    and xx-large.</span>
    <span class="c1">#  Relative sizes are: larger, smaller</span>
    <span class="c1">#  Length value is an absolute font size, e.g., 12pt</span>
    <span class="c1">#  Percentage values are in &#39;em&#39;s.  Most robust specification.</span>

    <span class="c1">#  All AFM fonts are apparently scalable.</span>

    <span class="n">size</span> <span class="o">=</span> <span class="s1">&#39;scalable&#39;</span>

    <span class="k">return</span> <span class="n">FontEntry</span><span class="p">(</span><span class="n">fontpath</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">variant</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">stretch</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>


<div class="viewcode-block" id="FontProperties"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties">[docs]</a><span class="k">class</span> <span class="nc">FontProperties</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for storing and manipulating font properties.</span>

<span class="sd">    The font properties are the six properties described in the</span>
<span class="sd">    `W3C Cascading Style Sheet, Level 1</span>
<span class="sd">    &lt;http://www.w3.org/TR/1998/REC-CSS2-19980512/&gt;`_ font</span>
<span class="sd">    specification and *math_fontfamily* for math fonts:</span>

<span class="sd">    - family: A list of font names in decreasing order of priority.</span>
<span class="sd">      The items may include a generic font family name, either</span>
<span class="sd">      &#39;sans-serif&#39; (default), &#39;serif&#39;, &#39;cursive&#39;, &#39;fantasy&#39;, or &#39;monospace&#39;.</span>
<span class="sd">      In that case, the actual font to be used will be looked up</span>
<span class="sd">      from the associated rcParam.</span>

<span class="sd">    - style: Either &#39;normal&#39; (default), &#39;italic&#39; or &#39;oblique&#39;.</span>

<span class="sd">    - variant: Either &#39;normal&#39; (default) or &#39;small-caps&#39;.</span>

<span class="sd">    - stretch: A numeric value in the range 0-1000 or one of</span>
<span class="sd">      &#39;ultra-condensed&#39;, &#39;extra-condensed&#39;, &#39;condensed&#39;,</span>
<span class="sd">      &#39;semi-condensed&#39;, &#39;normal&#39; (default), &#39;semi-expanded&#39;, &#39;expanded&#39;,</span>
<span class="sd">      &#39;extra-expanded&#39; or &#39;ultra-expanded&#39;.</span>

<span class="sd">    - weight: A numeric value in the range 0-1000 or one of</span>
<span class="sd">      &#39;ultralight&#39;, &#39;light&#39;, &#39;normal&#39; (default), &#39;regular&#39;, &#39;book&#39;, &#39;medium&#39;,</span>
<span class="sd">      &#39;roman&#39;, &#39;semibold&#39;, &#39;demibold&#39;, &#39;demi&#39;, &#39;bold&#39;, &#39;heavy&#39;,</span>
<span class="sd">      &#39;extra bold&#39;, &#39;black&#39;.</span>

<span class="sd">    - size: Either an relative value of &#39;xx-small&#39;, &#39;x-small&#39;,</span>
<span class="sd">      &#39;small&#39;, &#39;medium&#39;, &#39;large&#39;, &#39;x-large&#39;, &#39;xx-large&#39; or an</span>
<span class="sd">      absolute font size, e.g., 10 (default).</span>

<span class="sd">    - math_fontfamily: The family of fonts used to render math text; overrides</span>
<span class="sd">      :rc:`mathtext.fontset`. Supported values are the same as the ones</span>
<span class="sd">      supported by :rc:`mathtext.fontset`: &#39;dejavusans&#39;, &#39;dejavuserif&#39;, &#39;cm&#39;,</span>
<span class="sd">      &#39;stix&#39;, &#39;stixsans&#39; and &#39;custom&#39;.</span>

<span class="sd">    Alternatively, a font may be specified using the absolute path to a font</span>
<span class="sd">    file, by using the *fname* kwarg.  However, in this case, it is typically</span>
<span class="sd">    simpler to just pass the path (as a `pathlib.Path`, not a `str`) to the</span>
<span class="sd">    *font* kwarg of the `.Text` object.</span>

<span class="sd">    The preferred usage of font sizes is to use the relative values,</span>
<span class="sd">    e.g.,  &#39;large&#39;, instead of absolute font sizes, e.g., 12.  This</span>
<span class="sd">    approach allows all text sizes to be made larger or smaller based</span>
<span class="sd">    on the font manager&#39;s default font size.</span>

<span class="sd">    This class will also accept a fontconfig_ pattern_, if it is the only</span>
<span class="sd">    argument provided.  This support does not depend on fontconfig; we are</span>
<span class="sd">    merely borrowing its pattern syntax for use here.</span>

<span class="sd">    .. _fontconfig: https://www.freedesktop.org/wiki/Software/fontconfig/</span>
<span class="sd">    .. _pattern:</span>
<span class="sd">       https://www.freedesktop.org/software/fontconfig/fontconfig-user.html</span>

<span class="sd">    Note that Matplotlib&#39;s internal font manager and fontconfig use a</span>
<span class="sd">    different algorithm to lookup fonts, so the results of the same pattern</span>
<span class="sd">    may be different in Matplotlib than in other applications that use</span>
<span class="sd">    fontconfig.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FontProperties.__init__"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">variant</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">stretch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># if set, it&#39;s a hardcoded filename to use</span>
                 <span class="n">math_fontfamily</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_family</span> <span class="o">=</span> <span class="n">_normalize_font_family</span><span class="p">(</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slant</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.style&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variant</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.variant&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weight</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.weight&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stretch</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.stretch&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_math_fontfamily</span><span class="p">(</span><span class="n">math_fontfamily</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># Treat family as a fontconfig pattern if it is the only</span>
            <span class="c1"># parameter provided.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">style</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">variant</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">weight</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span>
                    <span class="n">stretch</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_fontconfig_pattern</span><span class="p">(</span><span class="n">family</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_family</span><span class="p">(</span><span class="n">family</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_variant</span><span class="p">(</span><span class="n">variant</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_weight</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_stretch</span><span class="p">(</span><span class="n">stretch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_file</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="n">size</span><span class="p">)</span></div>

<div class="viewcode-block" id="FontProperties._from_any"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties._from_any">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_any</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generic constructor which can build a `.FontProperties` from any of the</span>
<span class="sd">        following:</span>

<span class="sd">        - a `.FontProperties`: it is passed through as is;</span>
<span class="sd">        - `None`: a `.FontProperties` using rc values is used;</span>
<span class="sd">        - an `os.PathLike`: it is used as path to the font file;</span>
<span class="sd">        - a `str`: it is parsed as a fontconfig pattern;</span>
<span class="sd">        - a `dict`: it is passed as ``**kwargs`` to `.FontProperties`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">arg</span>
        <span class="k">elif</span> <span class="n">arg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">arg</span><span class="p">)</span></div>

<div class="viewcode-block" id="FontProperties.__hash__"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.__hash__">[docs]</a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_family</span><span class="p">()),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">get_slant</span><span class="p">(),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">get_variant</span><span class="p">(),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">get_weight</span><span class="p">(),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">get_stretch</span><span class="p">(),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">get_size_in_points</span><span class="p">(),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">get_file</span><span class="p">(),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">get_math_fontfamily</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="n">l</span><span class="p">)</span></div>

<div class="viewcode-block" id="FontProperties.__eq__"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.__eq__">[docs]</a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">hash</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>

<div class="viewcode-block" id="FontProperties.__str__"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.__str__">[docs]</a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fontconfig_pattern</span><span class="p">()</span></div>

<div class="viewcode-block" id="FontProperties.get_family"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.get_family">[docs]</a>    <span class="k">def</span> <span class="nf">get_family</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a list of font names that comprise the font family.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_family</span></div>

<div class="viewcode-block" id="FontProperties.get_name"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the name of the font that best matches the font properties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_font</span><span class="p">(</span><span class="n">findfont</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="o">.</span><span class="n">family_name</span></div>

<div class="viewcode-block" id="FontProperties.get_style"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.get_style">[docs]</a>    <span class="k">def</span> <span class="nf">get_style</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the font style.  Values are: &#39;normal&#39;, &#39;italic&#39; or &#39;oblique&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slant</span></div>
    <span class="n">get_slant</span> <span class="o">=</span> <span class="n">get_style</span>

<div class="viewcode-block" id="FontProperties.get_variant"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.get_variant">[docs]</a>    <span class="k">def</span> <span class="nf">get_variant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the font variant.  Values are: &#39;normal&#39; or &#39;small-caps&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variant</span></div>

<div class="viewcode-block" id="FontProperties.get_weight"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.get_weight">[docs]</a>    <span class="k">def</span> <span class="nf">get_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the font weight.  Options are: A numeric value in the</span>
<span class="sd">        range 0-1000 or one of &#39;light&#39;, &#39;normal&#39;, &#39;regular&#39;, &#39;book&#39;,</span>
<span class="sd">        &#39;medium&#39;, &#39;roman&#39;, &#39;semibold&#39;, &#39;demibold&#39;, &#39;demi&#39;, &#39;bold&#39;,</span>
<span class="sd">        &#39;heavy&#39;, &#39;extra bold&#39;, &#39;black&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weight</span></div>

<div class="viewcode-block" id="FontProperties.get_stretch"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.get_stretch">[docs]</a>    <span class="k">def</span> <span class="nf">get_stretch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the font stretch or width.  Options are: &#39;ultra-condensed&#39;,</span>
<span class="sd">        &#39;extra-condensed&#39;, &#39;condensed&#39;, &#39;semi-condensed&#39;, &#39;normal&#39;,</span>
<span class="sd">        &#39;semi-expanded&#39;, &#39;expanded&#39;, &#39;extra-expanded&#39;, &#39;ultra-expanded&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stretch</span></div>

<div class="viewcode-block" id="FontProperties.get_size"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.get_size">[docs]</a>    <span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the font size.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span></div>

<div class="viewcode-block" id="FontProperties.get_size_in_points"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.get_size_in_points">[docs]</a>    <span class="k">def</span> <span class="nf">get_size_in_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span></div>

<div class="viewcode-block" id="FontProperties.get_file"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.get_file">[docs]</a>    <span class="k">def</span> <span class="nf">get_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the filename of the associated font.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file</span></div>

<div class="viewcode-block" id="FontProperties.get_fontconfig_pattern"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.get_fontconfig_pattern">[docs]</a>    <span class="k">def</span> <span class="nf">get_fontconfig_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a fontconfig_ pattern_ suitable for looking up the font as</span>
<span class="sd">        specified with fontconfig&#39;s ``fc-match`` utility.</span>

<span class="sd">        This support does not depend on fontconfig; we are merely borrowing its</span>
<span class="sd">        pattern syntax for use here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">generate_fontconfig_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="FontProperties.set_family"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.set_family">[docs]</a>    <span class="k">def</span> <span class="nf">set_family</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">family</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the font family.  May be either an alias (generic name</span>
<span class="sd">        is CSS parlance), such as: &#39;serif&#39;, &#39;sans-serif&#39;, &#39;cursive&#39;,</span>
<span class="sd">        &#39;fantasy&#39;, or &#39;monospace&#39;, a real font name or a list of real</span>
<span class="sd">        font names.  Real font names are not supported when</span>
<span class="sd">        :rc:`text.usetex` is `True`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">family</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">family</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_family</span> <span class="o">=</span> <span class="n">_normalize_font_family</span><span class="p">(</span><span class="n">family</span><span class="p">)</span></div>
    <span class="n">set_name</span> <span class="o">=</span> <span class="n">set_family</span>

<div class="viewcode-block" id="FontProperties.set_style"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.set_style">[docs]</a>    <span class="k">def</span> <span class="nf">set_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the font style.  Values are: &#39;normal&#39;, &#39;italic&#39; or &#39;oblique&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.style&#39;</span><span class="p">]</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">check_in_list</span><span class="p">([</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="s1">&#39;italic&#39;</span><span class="p">,</span> <span class="s1">&#39;oblique&#39;</span><span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slant</span> <span class="o">=</span> <span class="n">style</span></div>
    <span class="n">set_slant</span> <span class="o">=</span> <span class="n">set_style</span>

<div class="viewcode-block" id="FontProperties.set_variant"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.set_variant">[docs]</a>    <span class="k">def</span> <span class="nf">set_variant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variant</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the font variant.  Values are: &#39;normal&#39; or &#39;small-caps&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">variant</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">variant</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.variant&#39;</span><span class="p">]</span>
        <span class="n">_api</span><span class="o">.</span><span class="n">check_in_list</span><span class="p">([</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="s1">&#39;small-caps&#39;</span><span class="p">],</span> <span class="n">variant</span><span class="o">=</span><span class="n">variant</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variant</span> <span class="o">=</span> <span class="n">variant</span></div>

<div class="viewcode-block" id="FontProperties.set_weight"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.set_weight">[docs]</a>    <span class="k">def</span> <span class="nf">set_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the font weight.  May be either a numeric value in the</span>
<span class="sd">        range 0-1000 or one of &#39;ultralight&#39;, &#39;light&#39;, &#39;normal&#39;,</span>
<span class="sd">        &#39;regular&#39;, &#39;book&#39;, &#39;medium&#39;, &#39;roman&#39;, &#39;semibold&#39;, &#39;demibold&#39;,</span>
<span class="sd">        &#39;demi&#39;, &#39;bold&#39;, &#39;heavy&#39;, &#39;extra bold&#39;, &#39;black&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.weight&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">weight</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">weight</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">weight</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">weight_dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;weight is invalid&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weight</span> <span class="o">=</span> <span class="n">weight</span></div>

<div class="viewcode-block" id="FontProperties.set_stretch"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.set_stretch">[docs]</a>    <span class="k">def</span> <span class="nf">set_stretch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stretch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the font stretch or width.  Options are: &#39;ultra-condensed&#39;,</span>
<span class="sd">        &#39;extra-condensed&#39;, &#39;condensed&#39;, &#39;semi-condensed&#39;, &#39;normal&#39;,</span>
<span class="sd">        &#39;semi-expanded&#39;, &#39;expanded&#39;, &#39;extra-expanded&#39; or</span>
<span class="sd">        &#39;ultra-expanded&#39;, or a numeric value in the range 0-1000.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stretch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stretch</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.stretch&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stretch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stretch</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">stretch</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">stretch</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stretch</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stretch_dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;stretch is invalid&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stretch</span> <span class="o">=</span> <span class="n">stretch</span></div>

<div class="viewcode-block" id="FontProperties.set_size"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.set_size">[docs]</a>    <span class="k">def</span> <span class="nf">set_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the font size.  Either an relative value of &#39;xx-small&#39;,</span>
<span class="sd">        &#39;x-small&#39;, &#39;small&#39;, &#39;medium&#39;, &#39;large&#39;, &#39;x-large&#39;, &#39;xx-large&#39;</span>
<span class="sd">        or an absolute font size, e.g., 12.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">font_scalings</span><span class="p">[</span><span class="n">size</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Size is invalid. Valid font size are &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">font_scalings</span><span class="p">)))</span> <span class="kn">from</span> <span class="nn">err</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">FontManager</span><span class="o">.</span><span class="n">get_default_size</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Fontsize </span><span class="si">%1.2f</span><span class="s1"> &lt; 1.0 pt not allowed by FreeType. &#39;</span>
                      <span class="s1">&#39;Setting fontsize = 1 pt&#39;</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
            <span class="n">size</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">size</span></div>

<div class="viewcode-block" id="FontProperties.set_file"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.set_file">[docs]</a>    <span class="k">def</span> <span class="nf">set_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the filename of the fontfile to use.  In this case, all</span>
<span class="sd">        other properties will be ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FontProperties.set_fontconfig_pattern"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.set_fontconfig_pattern">[docs]</a>    <span class="k">def</span> <span class="nf">set_fontconfig_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the properties by parsing a fontconfig_ *pattern*.</span>

<span class="sd">        This support does not depend on fontconfig; we are merely borrowing its</span>
<span class="sd">        pattern syntax for use here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">parse_fontconfig_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;set_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;set_&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)(</span><span class="n">val</span><span class="p">)</span></div>

<div class="viewcode-block" id="FontProperties.get_math_fontfamily"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.get_math_fontfamily">[docs]</a>    <span class="k">def</span> <span class="nf">get_math_fontfamily</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the name of the font family used for math text.</span>

<span class="sd">        The default font is :rc:`mathtext.fontset`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_math_fontfamily</span></div>

<div class="viewcode-block" id="FontProperties.set_math_fontfamily"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.set_math_fontfamily">[docs]</a>    <span class="k">def</span> <span class="nf">set_math_fontfamily</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontfamily</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the font family for text in math mode.</span>

<span class="sd">        If not set explicitly, :rc:`mathtext.fontset` will be used.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fontfamily : str</span>
<span class="sd">            The name of the font family.</span>

<span class="sd">            Available font families are defined in the</span>
<span class="sd">            matplotlibrc.template file</span>
<span class="sd">            :ref:`here &lt;customizing-with-matplotlibrc-files&gt;`</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        .text.Text.get_math_fontfamily</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fontfamily</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fontfamily</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.fontset&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">valid_fonts</span> <span class="o">=</span> <span class="n">_validators</span><span class="p">[</span><span class="s1">&#39;mathtext.fontset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="c1"># _check_in_list() Validates the parameter math_fontfamily as</span>
            <span class="c1"># if it were passed to rcParams[&#39;mathtext.fontset&#39;]</span>
            <span class="n">_api</span><span class="o">.</span><span class="n">check_in_list</span><span class="p">(</span><span class="n">valid_fonts</span><span class="p">,</span> <span class="n">math_fontfamily</span><span class="o">=</span><span class="n">fontfamily</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_math_fontfamily</span> <span class="o">=</span> <span class="n">fontfamily</span></div>

<div class="viewcode-block" id="FontProperties.copy"><a class="viewcode-back" href="../../vtools.functions.html#vtools.functions.frequency_response.FontProperties.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a copy of self.&quot;&quot;&quot;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)()</span>
        <span class="nb">vars</span><span class="p">(</span><span class="n">new</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">new</span></div></div>


<span class="k">class</span> <span class="nc">_JSONEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">FontManager</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="vm">__class__</span><span class="o">=</span><span class="s1">&#39;FontManager&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">FontEntry</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="vm">__class__</span><span class="o">=</span><span class="s1">&#39;FontEntry&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Cache paths of fonts shipped with Matplotlib relative to the</span>
                <span class="c1"># Matplotlib data path, which helps in the presence of venvs.</span>
                <span class="n">d</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">Path</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;fname&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">get_data_path</span><span class="p">()))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">return</span> <span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_json_decode</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;__class__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">o</span>
    <span class="k">elif</span> <span class="bp">cls</span> <span class="o">==</span> <span class="s1">&#39;FontManager&#39;</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">FontManager</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">FontManager</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span>
    <span class="k">elif</span> <span class="bp">cls</span> <span class="o">==</span> <span class="s1">&#39;FontEntry&#39;</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">FontEntry</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">FontEntry</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">fname</span><span class="p">):</span>
            <span class="n">r</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">get_data_path</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Don&#39;t know how to deserialize __class__=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">cls</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">json_dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dump `FontManager` *data* as JSON to the file named *filename*.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    json_load</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    File paths that are children of the Matplotlib data path (typically, fonts</span>
<span class="sd">    shipped with Matplotlib) are stored relative to that data path (to remain</span>
<span class="sd">    valid across virtualenvs).</span>

<span class="sd">    This function temporarily locks the output file to prevent multiple</span>
<span class="sd">    processes from overwriting one another&#39;s output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_lock_path</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fh</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">_JSONEncoder</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Could not save font_manager cache </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">json_load</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a `FontManager` from the JSON file named *filename*.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    json_dump</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span> <span class="n">object_hook</span><span class="o">=</span><span class="n">_json_decode</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_normalize_font_family</span><span class="p">(</span><span class="n">family</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">family</span> <span class="o">=</span> <span class="p">[</span><span class="n">family</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">family</span>


<span class="k">class</span> <span class="nc">FontManager</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    On import, the `FontManager` singleton instance creates a list of ttf and</span>
<span class="sd">    afm fonts and caches their `FontProperties`.  The `FontManager.findfont`</span>
<span class="sd">    method does a nearest neighbor search to find the font that most closely</span>
<span class="sd">    matches the specification.  If no good enough match is found, the default</span>
<span class="sd">    font is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Increment this version number whenever the font cache data</span>
    <span class="c1"># format or behavior has changed and requires a existing font</span>
    <span class="c1"># cache files to be rebuilt.</span>
    <span class="n">__version__</span> <span class="o">=</span> <span class="mi">330</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__version__</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__default_weight</span> <span class="o">=</span> <span class="n">weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_size</span> <span class="o">=</span> <span class="n">size</span>

        <span class="c1"># Create list of font paths.</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">cbook</span><span class="o">.</span><span class="n">_get_data_path</span><span class="p">(</span><span class="s1">&#39;fonts&#39;</span><span class="p">,</span> <span class="n">subdir</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">subdir</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ttf&#39;</span><span class="p">,</span> <span class="s1">&#39;afm&#39;</span><span class="p">,</span> <span class="s1">&#39;pdfcorefonts&#39;</span><span class="p">]]</span>
        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;font search path </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">paths</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">defaultFamily</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ttf&#39;</span><span class="p">:</span> <span class="s1">&#39;DejaVu Sans&#39;</span><span class="p">,</span>
            <span class="s1">&#39;afm&#39;</span><span class="p">:</span> <span class="s1">&#39;Helvetica&#39;</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">afmlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ttflist</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Delay the warning by 5s.</span>
        <span class="n">timer</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s1">&#39;Matplotlib is building the font cache; this may take a moment.&#39;</span><span class="p">))</span>
        <span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fontext</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;afm&quot;</span><span class="p">,</span> <span class="s2">&quot;ttf&quot;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">findSystemFonts</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">fontext</span><span class="o">=</span><span class="n">fontext</span><span class="p">),</span>
                             <span class="o">*</span><span class="n">findSystemFonts</span><span class="p">(</span><span class="n">fontext</span><span class="o">=</span><span class="n">fontext</span><span class="p">)]:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">addfont</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                        <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failed to open font file </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">exc</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                        <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Failed to extract font properties from </span><span class="si">%s</span><span class="s2">: &quot;</span>
                                  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">exc</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">timer</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">addfont</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cache the properties of the font at *path* to make it available to the</span>
<span class="sd">        `FontManager`.  The type of font is inferred from the path suffix.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str or path-like</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.afm&quot;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
                <span class="n">font</span> <span class="o">=</span> <span class="n">afm</span><span class="o">.</span><span class="n">AFM</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">afmFontProperty</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">afmlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">ft2font</span><span class="o">.</span><span class="n">FT2Font</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">ttfFontProperty</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ttflist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">defaultFont</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Lazily evaluated (findfont then caches the result) to avoid including</span>
        <span class="c1"># the venv path in the json serialization.</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">ext</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">findfont</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">fontext</span><span class="o">=</span><span class="n">ext</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ext</span><span class="p">,</span> <span class="n">family</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultFamily</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="k">def</span> <span class="nf">get_default_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the default font weight.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__default_weight</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_default_size</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the default font size.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set_default_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the default font weight.  The initial value is &#39;normal&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__default_weight</span> <span class="o">=</span> <span class="n">weight</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_expand_aliases</span><span class="p">(</span><span class="n">family</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">family</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;sans&#39;</span><span class="p">,</span> <span class="s1">&#39;sans serif&#39;</span><span class="p">):</span>
            <span class="n">family</span> <span class="o">=</span> <span class="s1">&#39;sans-serif&#39;</span>
        <span class="k">return</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.&#39;</span> <span class="o">+</span> <span class="n">family</span><span class="p">]</span>

    <span class="c1"># Each of the scoring functions below should return a value between</span>
    <span class="c1"># 0.0 (perfect match) and 1.0 (terrible match)</span>
    <span class="k">def</span> <span class="nf">score_family</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">families</span><span class="p">,</span> <span class="n">family2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a match score between the list of font families in</span>
<span class="sd">        *families* and the font family name *family2*.</span>

<span class="sd">        An exact match at the head of the list returns 0.0.</span>

<span class="sd">        A match further down the list will return between 0 and 1.</span>

<span class="sd">        No match will return 1.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">families</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">families</span> <span class="o">=</span> <span class="p">[</span><span class="n">families</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">families</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.0</span>
        <span class="n">family2</span> <span class="o">=</span> <span class="n">family2</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">families</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">family1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">families</span><span class="p">):</span>
            <span class="n">family1</span> <span class="o">=</span> <span class="n">family1</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">family1</span> <span class="ow">in</span> <span class="n">font_family_aliases</span><span class="p">:</span>
                <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_aliases</span><span class="p">(</span><span class="n">family1</span><span class="p">))]</span>
                <span class="k">if</span> <span class="n">family2</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">family2</span><span class="p">)</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">idx</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="p">)))</span> <span class="o">*</span> <span class="n">step</span>
            <span class="k">elif</span> <span class="n">family1</span> <span class="o">==</span> <span class="n">family2</span><span class="p">:</span>
                <span class="c1"># The score should be weighted by where in the</span>
                <span class="c1"># list the font was found.</span>
                <span class="k">return</span> <span class="n">i</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">return</span> <span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">score_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style1</span><span class="p">,</span> <span class="n">style2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a match score between *style1* and *style2*.</span>

<span class="sd">        An exact match returns 0.0.</span>

<span class="sd">        A match between &#39;italic&#39; and &#39;oblique&#39; returns 0.1.</span>

<span class="sd">        No match returns 1.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">style1</span> <span class="o">==</span> <span class="n">style2</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">style1</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;italic&#39;</span><span class="p">,</span> <span class="s1">&#39;oblique&#39;</span><span class="p">)</span>
              <span class="ow">and</span> <span class="n">style2</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;italic&#39;</span><span class="p">,</span> <span class="s1">&#39;oblique&#39;</span><span class="p">)):</span>
            <span class="k">return</span> <span class="mf">0.1</span>
        <span class="k">return</span> <span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">score_variant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variant1</span><span class="p">,</span> <span class="n">variant2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a match score between *variant1* and *variant2*.</span>

<span class="sd">        An exact match returns 0.0, otherwise 1.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">variant1</span> <span class="o">==</span> <span class="n">variant2</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">score_stretch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stretch1</span><span class="p">,</span> <span class="n">stretch2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a match score between *stretch1* and *stretch2*.</span>

<span class="sd">        The result is the absolute value of the difference between the</span>
<span class="sd">        CSS numeric values of *stretch1* and *stretch2*, normalized</span>
<span class="sd">        between 0.0 and 1.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stretchval1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stretch1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">stretchval1</span> <span class="o">=</span> <span class="n">stretch_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">stretch1</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stretchval2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stretch2</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">stretchval2</span> <span class="o">=</span> <span class="n">stretch_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">stretch2</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">stretchval1</span> <span class="o">-</span> <span class="n">stretchval2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000.0</span>

    <span class="k">def</span> <span class="nf">score_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight1</span><span class="p">,</span> <span class="n">weight2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a match score between *weight1* and *weight2*.</span>

<span class="sd">        The result is 0.0 if both weight1 and weight 2 are given as strings</span>
<span class="sd">        and have the same value.</span>

<span class="sd">        Otherwise, the result is the absolute value of the difference between</span>
<span class="sd">        the CSS numeric values of *weight1* and *weight2*, normalized between</span>
<span class="sd">        0.05 and 1.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># exact match of the weight names, e.g. weight1 == weight2 == &quot;regular&quot;</span>
        <span class="k">if</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_str_equal</span><span class="p">(</span><span class="n">weight1</span><span class="p">,</span> <span class="n">weight2</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="n">w1</span> <span class="o">=</span> <span class="n">weight1</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weight1</span><span class="p">,</span> <span class="n">Number</span><span class="p">)</span> <span class="k">else</span> <span class="n">weight_dict</span><span class="p">[</span><span class="n">weight1</span><span class="p">]</span>
        <span class="n">w2</span> <span class="o">=</span> <span class="n">weight2</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weight2</span><span class="p">,</span> <span class="n">Number</span><span class="p">)</span> <span class="k">else</span> <span class="n">weight_dict</span><span class="p">[</span><span class="n">weight2</span><span class="p">]</span>
        <span class="k">return</span> <span class="mf">0.95</span> <span class="o">*</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">w1</span> <span class="o">-</span> <span class="n">w2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.05</span>

    <span class="k">def</span> <span class="nf">score_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size1</span><span class="p">,</span> <span class="n">size2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a match score between *size1* and *size2*.</span>

<span class="sd">        If *size2* (the size specified in the font file) is &#39;scalable&#39;, this</span>
<span class="sd">        function always returns 0.0, since any font size can be generated.</span>

<span class="sd">        Otherwise, the result is the absolute distance between *size1* and</span>
<span class="sd">        *size2*, normalized so that the usual range of font sizes (6pt -</span>
<span class="sd">        72pt) will lie between 0.0 and 1.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">size2</span> <span class="o">==</span> <span class="s1">&#39;scalable&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="c1"># Size value should have already been</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sizeval1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">size1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">sizeval1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_size</span> <span class="o">*</span> <span class="n">font_scalings</span><span class="p">[</span><span class="n">size1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sizeval2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">size2</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sizeval1</span> <span class="o">-</span> <span class="n">sizeval2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">72</span>

    <span class="k">def</span> <span class="nf">findfont</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">fontext</span><span class="o">=</span><span class="s1">&#39;ttf&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">fallback_to_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rebuild_if_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find a font that most closely matches the given font properties.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : str or `~matplotlib.font_manager.FontProperties`</span>
<span class="sd">            The font properties to search for. This can be either a</span>
<span class="sd">            `.FontProperties` object or a string defining a</span>
<span class="sd">            `fontconfig patterns`_.</span>

<span class="sd">        fontext : {&#39;ttf&#39;, &#39;afm&#39;}, default: &#39;ttf&#39;</span>
<span class="sd">            The extension of the font file:</span>

<span class="sd">            - &#39;ttf&#39;: TrueType and OpenType fonts (.ttf, .ttc, .otf)</span>
<span class="sd">            - &#39;afm&#39;: Adobe Font Metrics (.afm)</span>

<span class="sd">        directory : str, optional</span>
<span class="sd">            If given, only search this directory and its subdirectories.</span>

<span class="sd">        fallback_to_default : bool</span>
<span class="sd">            If True, will fallback to the default font family (usually</span>
<span class="sd">            &quot;DejaVu Sans&quot; or &quot;Helvetica&quot;) if the first lookup hard-fails.</span>

<span class="sd">        rebuild_if_missing : bool</span>
<span class="sd">            Whether to rebuild the font cache and search again if the first</span>
<span class="sd">            match appears to point to a nonexisting font (i.e., the font cache</span>
<span class="sd">            contains outdated entries).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The filename of the best matching font.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This performs a nearest neighbor search.  Each font is given a</span>
<span class="sd">        similarity score to the target font properties.  The first font with</span>
<span class="sd">        the highest score is returned.  If no matches below a certain</span>
<span class="sd">        threshold are found, the default font (usually DejaVu Sans) is</span>
<span class="sd">        returned.</span>

<span class="sd">        The result is cached, so subsequent lookups don&#39;t have to</span>
<span class="sd">        perform the O(n) nearest neighbor search.</span>

<span class="sd">        See the `W3C Cascading Style Sheet, Level 1</span>
<span class="sd">        &lt;http://www.w3.org/TR/1998/REC-CSS2-19980512/&gt;`_ documentation</span>
<span class="sd">        for a description of the font finding algorithm.</span>

<span class="sd">        .. _fontconfig patterns:</span>
<span class="sd">           https://www.freedesktop.org/software/fontconfig/fontconfig-user.html</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Pass the relevant rcParams (and the font manager, as `self`) to</span>
        <span class="c1"># _findfont_cached so to prevent using a stale cache entry after an</span>
        <span class="c1"># rcParam was changed.</span>
        <span class="n">rc_params</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">rcParams</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;font.serif&quot;</span><span class="p">,</span> <span class="s2">&quot;font.sans-serif&quot;</span><span class="p">,</span> <span class="s2">&quot;font.cursive&quot;</span><span class="p">,</span> <span class="s2">&quot;font.fantasy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;font.monospace&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_findfont_cached</span><span class="p">(</span>
            <span class="n">prop</span><span class="p">,</span> <span class="n">fontext</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">fallback_to_default</span><span class="p">,</span> <span class="n">rebuild_if_missing</span><span class="p">,</span>
            <span class="n">rc_params</span><span class="p">)</span>

    <span class="nd">@lru_cache</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_findfont_cached</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">fontext</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">fallback_to_default</span><span class="p">,</span>
                         <span class="n">rebuild_if_missing</span><span class="p">,</span> <span class="n">rc_params</span><span class="p">):</span>

        <span class="n">prop</span> <span class="o">=</span> <span class="n">FontProperties</span><span class="o">.</span><span class="n">_from_any</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

        <span class="n">fname</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">get_file</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fname</span>

        <span class="k">if</span> <span class="n">fontext</span> <span class="o">==</span> <span class="s1">&#39;afm&#39;</span><span class="p">:</span>
            <span class="n">fontlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">afmlist</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fontlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ttflist</span>

        <span class="n">best_score</span> <span class="o">=</span> <span class="mf">1e64</span>
        <span class="n">best_font</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;findfont: Matching </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">font</span> <span class="ow">in</span> <span class="n">fontlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                    <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">font</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># Matching family should have top priority, so multiply it by 10.</span>
            <span class="n">score</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score_family</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">get_family</span><span class="p">(),</span> <span class="n">font</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
                     <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_style</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">get_style</span><span class="p">(),</span> <span class="n">font</span><span class="o">.</span><span class="n">style</span><span class="p">)</span>
                     <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_variant</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">get_variant</span><span class="p">(),</span> <span class="n">font</span><span class="o">.</span><span class="n">variant</span><span class="p">)</span>
                     <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_weight</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">get_weight</span><span class="p">(),</span> <span class="n">font</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
                     <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_stretch</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">get_stretch</span><span class="p">(),</span> <span class="n">font</span><span class="o">.</span><span class="n">stretch</span><span class="p">)</span>
                     <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_size</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">get_size</span><span class="p">(),</span> <span class="n">font</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;findfont: score(</span><span class="si">%s</span><span class="s1">) = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="n">best_score</span><span class="p">:</span>
                <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
                <span class="n">best_font</span> <span class="o">=</span> <span class="n">font</span>
            <span class="k">if</span> <span class="n">score</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">best_font</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">best_score</span> <span class="o">&gt;=</span> <span class="mf">10.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fallback_to_default</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s1">&#39;findfont: Font family </span><span class="si">%s</span><span class="s1"> not found. Falling back to </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span>
                    <span class="n">prop</span><span class="o">.</span><span class="n">get_family</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultFamily</span><span class="p">[</span><span class="n">fontext</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">family</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">prop</span><span class="o">.</span><span class="n">get_family</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="n">family</span> <span class="ow">in</span> <span class="n">font_family_aliases</span><span class="p">:</span>
                        <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="s2">&quot;findfont: Generic family </span><span class="si">%r</span><span class="s2"> not found because &quot;</span>
                            <span class="s2">&quot;none of the following families were found: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">family</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_expand_aliases</span><span class="p">(</span><span class="n">family</span><span class="p">)))</span>
                <span class="n">default_prop</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">default_prop</span><span class="o">.</span><span class="n">set_family</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defaultFamily</span><span class="p">[</span><span class="n">fontext</span><span class="p">])</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">findfont</span><span class="p">(</span><span class="n">default_prop</span><span class="p">,</span> <span class="n">fontext</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span>
                                     <span class="n">fallback_to_default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to find font </span><span class="si">{</span><span class="n">prop</span><span class="si">}</span><span class="s2">, and fallback &quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;to the default font was disabled&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;findfont: Matching </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%r</span><span class="s1">) with score of </span><span class="si">%f</span><span class="s1">.&#39;</span><span class="p">,</span>
                       <span class="n">prop</span><span class="p">,</span> <span class="n">best_font</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">best_font</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="n">best_score</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">best_font</span><span class="o">.</span><span class="n">fname</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rebuild_if_missing</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s1">&#39;findfont: Found a missing font file.  Rebuilding cache.&#39;</span><span class="p">)</span>
                <span class="n">new_fm</span> <span class="o">=</span> <span class="n">_load_fontmanager</span><span class="p">(</span><span class="n">try_read_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1"># Replace self by the new fontmanager, because users may have</span>
                <span class="c1"># a reference to this specific instance.</span>
                <span class="c1"># TODO: _load_fontmanager should really be (used by) a method</span>
                <span class="c1"># modifying the instance in place.</span>
                <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">new_fm</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">findfont</span><span class="p">(</span>
                    <span class="n">prop</span><span class="p">,</span> <span class="n">fontext</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">rebuild_if_missing</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No valid font could be found&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_cached_realpath</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>


<span class="nd">@lru_cache</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">is_opentype_cff_font</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return whether the given font is a Postscript Compact Font Format Font</span>
<span class="sd">    embedded in an OpenType wrapper.  Used by the PostScript and PDF backends</span>
<span class="sd">    that can not subset these fonts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;.otf&#39;</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;OTTO&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="nd">@lru_cache</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_get_font</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">hinting_factor</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">_kerning_factor</span><span class="p">,</span> <span class="n">thread_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ft2font</span><span class="o">.</span><span class="n">FT2Font</span><span class="p">(</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">hinting_factor</span><span class="p">,</span> <span class="n">_kerning_factor</span><span class="o">=</span><span class="n">_kerning_factor</span><span class="p">)</span>


<span class="c1"># FT2Font objects cannot be used across fork()s because they reference the same</span>
<span class="c1"># FT_Library object.  While invalidating *all* existing FT2Fonts after a fork</span>
<span class="c1"># would be too complicated to be worth it, the main way FT2Fonts get reused is</span>
<span class="c1"># via the cache of _get_font, which we can empty upon forking (in Py3.7+).</span>
<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s2">&quot;register_at_fork&quot;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">register_at_fork</span><span class="p">(</span><span class="n">after_in_child</span><span class="o">=</span><span class="n">_get_font</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_font</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">hinting_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Resolving the path avoids embedding the font twice in pdf/ps output if a</span>
    <span class="c1"># single font is selected using two different relative paths.</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">_cached_realpath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hinting_factor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hinting_factor</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.hinting_factor&#39;</span><span class="p">]</span>
    <span class="c1"># also key on the thread ID to prevent segfaults with multi-threading</span>
    <span class="k">return</span> <span class="n">_get_font</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">hinting_factor</span><span class="p">,</span>
                     <span class="n">_kerning_factor</span><span class="o">=</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.kerning_factor&#39;</span><span class="p">],</span>
                     <span class="n">thread_id</span><span class="o">=</span><span class="n">threading</span><span class="o">.</span><span class="n">get_ident</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">_load_fontmanager</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">try_read_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">fm_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">get_cachedir</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;fontlist-v</span><span class="si">{</span><span class="n">FontManager</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">try_read_cache</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fm</span> <span class="o">=</span> <span class="n">json_load</span><span class="p">(</span><span class="n">fm_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fm</span><span class="p">,</span> <span class="s2">&quot;_version&quot;</span><span class="p">,</span> <span class="nb">object</span><span class="p">())</span> <span class="o">==</span> <span class="n">FontManager</span><span class="o">.</span><span class="n">__version__</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using fontManager instance from </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fm_path</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">fm</span>
    <span class="n">fm</span> <span class="o">=</span> <span class="n">FontManager</span><span class="p">()</span>
    <span class="n">json_dump</span><span class="p">(</span><span class="n">fm</span><span class="p">,</span> <span class="n">fm_path</span><span class="p">)</span>
    <span class="n">_log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;generated new fontManager&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fm</span>


<span class="n">fontManager</span> <span class="o">=</span> <span class="n">_load_fontmanager</span><span class="p">()</span>
<span class="n">findfont</span> <span class="o">=</span> <span class="n">fontManager</span><span class="o">.</span><span class="n">findfont</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, California Department of Water Resources.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>