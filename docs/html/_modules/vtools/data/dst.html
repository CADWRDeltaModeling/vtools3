<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>vtools.data.dst &#8212; vtools 0.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <link rel="stylesheet" type="text/css" href="../../../_static/plot_directive.css" />
    <script src="../../../_static/documentation_options.js?v=7026087e"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../_static/logo.png" border="0" alt="py4sci"/></a>
</div>



      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/dwrsmall.jpg" alt="Logo"/>
            </a></p>
<p class="logo">
  <a href="../../../index.html">
    <img class="logo" src="../../../_static/dwrsmall.jpg" alt="Logo" />
    
  </a>
</p>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts.html">Introduction and concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../daylight_savings.html">Daylight Savings conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../interpolation.html">Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/filters.html">Averging, Filtering and Low Passing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/filters.html#Filters">Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/tidal_envelope.html">Tidal Envelope Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/climatology.html">Fitting and using a climatology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/merge_splice.html">Merging and Splicing Time Series</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/merge_splice.html#ts_merge:-strict-priority-option"><code class="docutils literal notranslate"><span class="pre">ts_merge</span></code>: strict priority option</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/extrapolation.html">Extrapolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/transition.html">Transitioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for vtools.data.dst</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Daylight Savings Time Conversion</span>
<span class="sd">================================</span>

<span class="sd">This module provides the function :func:`dst_st` for converting a pandas Series/Dataframe</span>
<span class="sd">with a naive DatetimeIndex that observes daylight savings time (DST) to a fixed</span>
<span class="sd">standard time zone (e.g., PST) using POSIX conventions.</span>

<span class="sd">See the automatic API documentation for details:</span>
<span class="sd">:py:func:`vtools.data.dst.dst_st`</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dst_st&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="dst_st">
<a class="viewcode-back" href="../../../vtools.data.html#vtools.data.dst.dst_st">[docs]</a>
<span class="k">def</span> <span class="nf">dst_st</span><span class="p">(</span>
    <span class="n">ts</span><span class="p">,</span>
    <span class="n">src_tz</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;US/Pacific&quot;</span><span class="p">,</span>
    <span class="n">target_tz</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Etc/GMT+8&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a pandas Series with a datetime index from a timezone-unaware index</span>
<span class="sd">    that observes DST (e.g., US/Pacific) to a fixed standard time zone (e.g., Etc/GMT+8)</span>
<span class="sd">    using POSIX conventions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ts : pandas.Series</span>
<span class="sd">        Time series with a naive (timezone-unaware) DatetimeIndex.</span>
<span class="sd">    src_tz : str, optional</span>
<span class="sd">        Source timezone name (default is &#39;US/Pacific&#39;).</span>
<span class="sd">    target_tz : str, optional</span>
<span class="sd">        Target standard timezone name (default is &#39;Etc/GMT+8&#39;).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Series</span>
<span class="sd">        Time series with index converted to the target standard timezone and made naive.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The function assumes the index is not already timezone-aware.</span>
<span class="sd">    - &#39;Etc/GMT+8&#39; is the correct tz name for UTC-8 (PST) in pytz; note the sign is reversed from what</span>
<span class="sd">      might be expected.</span>
<span class="sd">    - Handles ambiguous/nonexistent times due to DST transitions.</span>
<span class="sd">    - The returned index is naive (timezone-unaware) but represents the correct standard time.</span>
<span class="sd">    - If the input index is already timezone-aware, this function will raise an error.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">    &gt;&gt;&gt; from vtools import dst_st</span>
<span class="sd">    &gt;&gt;&gt; rng = pd.date_range(&quot;2023-11-05 00:00&quot;, &quot;2023-11-05 04:00&quot;, freq=&quot;30min&quot;)</span>
<span class="sd">    &gt;&gt;&gt; ts = pd.Series(range(len(rng)), index=rng)</span>
<span class="sd">    &gt;&gt;&gt; converted = dst_st(ts)</span>
<span class="sd">    &gt;&gt;&gt; print(converted)</span>
<span class="sd">    2023-11-05 00:00:00    0</span>
<span class="sd">    2023-11-05 00:30:00    1</span>
<span class="sd">    2023-11-05 01:00:00    2</span>
<span class="sd">    2023-11-05 01:30:00    3</span>
<span class="sd">    2023-11-05 02:30:00    5</span>
<span class="sd">    2023-11-05 03:00:00    6</span>
<span class="sd">    2023-11-05 03:30:00    7</span>
<span class="sd">    2023-11-05 04:00:00    8</span>
<span class="sd">    dtype: int64</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">orig_freq</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span>
        <span class="n">src_tz</span><span class="p">,</span>
        <span class="n">nonexistent</span><span class="o">=</span><span class="s2">&quot;shift_backward&quot;</span><span class="p">,</span>  <span class="c1"># Handle nonexistent times (e.g., spring forward)</span>
        <span class="n">ambiguous</span><span class="o">=</span><span class="s2">&quot;NaT&quot;</span>                <span class="c1"># Mark ambiguous times (e.g., fall back) as NaT</span>
    <span class="p">)</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="n">target_tz</span><span class="p">)</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="c1"># Drop NaT values in the index (from ambiguous times)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
    <span class="c1"># Try to restore original frequency if possible</span>
    <span class="k">if</span> <span class="n">orig_freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">orig_freq</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="n">ts</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="c1"># Create a DatetimeIndex that spans the PDT to PST transition (first Sunday in November)</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;2023-11-05 00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;2023-11-05 04:00&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;30min&quot;</span><span class="p">)</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Original (naive, US/Pacific):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>

    <span class="n">converted</span> <span class="o">=</span> <span class="n">dst_st</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Converted to standard time (Etc/GMT+8, naive):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">converted</span><span class="p">)</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2019, California Department of Water Resources.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>